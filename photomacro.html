<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>üì∑ Photo to Macro</title>
    <style>
        body {
          font-family: sans-serif;
          background: #121212;
          color: white;
          padding: 20px;
        }
        input, button {
          margin-top: 10px;
        }
        #preview {
          margin-top: 20px;
          max-width: 300px;
          border: 2px solid #555;
        }
        pre {
          background: #1e1e1e;
          padding: 10px;
          margin-top: 20px;
          overflow-x: auto;
        }
    </style>
</head>
<body>
<h1>üì∏ Upload Food Photo</h1>
<input type="file" accept="image/*" capture="environment" id="photoInput" />
<br>
<button id="analyzeBtn">üîç Analyze Food</button>
<br>
<img id="preview" />
<pre id="output"></pre>

<script>
    const photoInput = document.getElementById('photoInput');
    const preview = document.getElementById('preview');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const output = document.getElementById('output');
    let imageBase64 = "";

    photoInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onloadend = () => {
          imageBase64 = reader.result.split(',')[1];
          preview.src = reader.result;
        };
        reader.readAsDataURL(file);
      }
    });

    analyzeBtn.addEventListener('click', async () => {
      if (!imageBase64) return alert("Please upload a photo first.");
      output.textContent = "Analyzing...";

      const response = await fetch("/analyze-photo", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ imageBase64 })
      });

      const data = await response.json();
      output.textContent = JSON.stringify(data, null, 2);
    });
</script>
</body>
</html>
